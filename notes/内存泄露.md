## 潜在的内存泄露

### 引言
什么是内存泄露？

系统进程不再用到的内存，没有及时释放，就叫做**内存泄漏（memory leak）**. 当内存占用越来越高，轻则影响系统性能，重则导致进程崩溃. 站在前端的视角.写的不好的 JavaScript 可能出现难以察觉且有害的内存泄露问题：

* 白屏 / 黑屏
* 卡顿 / 页面加载迟缓
* 闪退 / 发热
* 💥


### 哪些操作会造成内存泄露

> 一、意外声明全局变量

意外声明全局变量是最常见但也最容易解决的内存泄露问题. **在 window上创建的属性,只要 window 本身不被清除就不会消失. 无法做到有效地释放清除**

1. 代码编写

```javascript
function t(){
   name = 'renlingxin'
}
//name 变量会挂在到window上 而window上的变量在窗口关闭或重新刷新页面之前并不会销毁
// 用let const var 代替

```

2. 其他挂载

插件\或业务场景中有时会通过挂载到 window 的属性 实现运行环境下 不同工程之间地相互通信 例如 

1. WebView / JavaScript 
2. Cocos / JavaScript
3. SDK - A / SDK - B
4. ...

我们需要合理正确的挂载. 避免挂载大体积的数据.

> 二、闭包

```javascript
function d(){
  let name = 'renlingxin'
  return function r(){
    console.log(name)
  }
}
//这会导致分配给name的内存被泄露.如果name很大.就会是一个大问题.

```

> 三、定时器(做到及时的clear)

保持良好的代码习惯.

```vue

<template>
 <div>{{ timeDom }}</div>
</template>

<script>
  mounted() {
    this._time = setInterval(() => {
      this.timeDom  = new Date()
    }, 1000);
  },
  // beforeDestroy 销毁之前的定时器
  beforeDestroy() {
    clearInterval(this._time())
  }
</script>

```


> 四、事件监听器(例如vue的eventBus)

```vue

import eventBus from './eventBus'

export default {
  mounted() {
    // 添加 eventBus 监听器
    eventBus.$on('custom-event', () => {
      console.log('Custom event triggered!')
    })
  },
  beforeDestroy() {
    // 移除 eventBus 监听器
    eventBus.$off('custom-event')
  }
}

```


> 五、变量和Dom之间地相互引用(可以使用 weakMap / weakSet 建立弱引用关系)


> 六、console（浏览器会记忆输出的变量。避免在线上环境打印）


### 调试

> Performance monitor 

实时监控工具



>  Memory

快照功能


> Performance

最全面的监控工具



